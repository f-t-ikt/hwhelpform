<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>教員用画面</title>
        <style>
            body {
                text-align: center;
                width: 100%;
                margin: 0 auto;
                font-size: 200%;
            }
            #help, #call {
                margin: 0 auto;
                table-layout: auto;
            }
            button {
                font-size: 80%;
            }
        </style>
    </head>
    
    <body>
        <div id="top">
            <p>教員用画面</p>
        </div>
        <div>
            <table id="help" border="1">
                <tr><th colspan="2" bgcolor="#ffc0cb">質問待機中の部屋</th></tr>
            </table>
        </div>
        <div>
            <table id="call" border="1">
                <tr><th colspan="2" bgcolor="#ffff00">先生待機中の部屋</th></tr>
            </table>
        </div>
        
        <script>
            var room = document.getElementById("room");
            var help = document.getElementById("help");
            var call = document.getElementById("call");
            var socket = new WebSocket("wss://" + window.location.host + "/update");
            
            socket.onopen = function() {
                <!-- help.innerHTML += "LOAD<br>"; -->
                <!-- call.innerHTML += "LOAD<br>"; -->
            };
            
            socket.onmessage = function(e) {
                var post = JSON.parse(e.data);
                if (post.Method == "help") {
                    addCol(help, post.Id, "Help");
                } else if (post.Method == "call") {
                    addCol(call, post.Id, "Call");
                } else if (post.Method == "deleteHelp" || "deleteCall") {
                    var element = document.getElementById(post.Id);
                    deleteCol(element);
                }
            };
            
            function deletePost(id, field) {
                if (socket.readyState > WebSocket.OPEN) {
                    document.getElementById("top").innerHTML += "<div style=\"color: red;\">切断されました。リロードしてください。</div>";
                    return;
                }
                
                socket.send(JSON.stringify(
                    {
                        Method: "delete" + field,
                        Id: id
                    }
                ));
            };
            
            function addCol(table, id, field) {
                var row = table.insertRow(-1);
                row.id = id;
                var cell1 = row.insertCell(-1);
                var cell2 = row.insertCell(-1);
                cell1.innerHTML = id;
                var button = document.createElement("button");
                button.onclick = function(){deletePost(id, field)};
                button.innerHTML = "確認"
                cell2.appendChild(button);
            };
            
            function deleteCol(obj) {
                var table = obj.parentNode;
                table.deleteRow(obj.sectionRowIndex);
            };
        </script>
    </body>
</html>
